{"version":3,"sources":["../../lib/client/runtime.js"],"names":["global","_try","func","ex","setResult","error","name","message","stack","_execute","eval","_code","debug","args","_debug","JSON","stringify","dispatch","callback","parameters","wrappedCallback","apply","parse","push","json","_dispatch","result","Error","value","httpRequest","options","httpRequestOld","_httpRequest","response","setTimeout","timeout","clearTimeout","id","console","log","define","defineBlocking","defineAsync","pop"],"mappings":"AAAAA,MAAM,CAACC,IAAP,GAAeC,IAAD,IAAU;AACtB,MAAI;AACFA,IAAAA,IAAI;AACL,GAFD,CAEE,OAAOC,EAAP,EAAW;AACXH,IAAAA,MAAM,CAACI,SAAP,CAAiB;AACfC,MAAAA,KAAK,EAAE;AACLC,QAAAA,IAAI,EAAEH,EAAE,CAACG,IADJ;AAELC,QAAAA,OAAO,EAAEJ,EAAE,CAACI,OAFP;AAGLC,QAAAA,KAAK,EAAEL,EAAE,CAACK;AAHL;AADQ,KAAjB;AAOD;AACF,CAZD;;AAcAR,MAAM,CAACS,QAAP,GAAkB,MAAM;AACtBT,EAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChBS,IAAAA,IAAI,CAACV,MAAM,CAACW,KAAR,CAAJ;AACD,GAFD;AAGD,CAJD;;AAMAX,MAAM,CAACY,KAAP,GAAe,CAAC,GAAGC,IAAJ,KAAa;AAC1Bb,EAAAA,MAAM,CAACc,MAAP,CAAcC,IAAI,CAACC,SAAL,CAAeH,IAAf,CAAd;AACD,CAFD;;AAIAb,MAAM,CAACiB,QAAP,GAAkB,CAACX,IAAD,EAAOO,IAAP,EAAaK,QAAb,KAA0B;AAC1C,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClCA,IAAAA,QAAQ,GAAG,IAAX;AACD;;AAED,QAAMC,UAAU,GAAG,CAAEJ,IAAI,CAACC,SAAL,CAAe;AAAEV,IAAAA,IAAF;AAAQO,IAAAA,IAAI,EAAEA,IAAI,IAAI;AAAtB,GAAf,CAAF,CAAnB;;AAEA,QAAMO,eAAe,GAAG,CAAC,GAAGP,IAAJ,KAAa;AACnCb,IAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChBiB,MAAAA,QAAQ,CAACG,KAAT,CAAe,IAAf,EAAqBN,IAAI,CAACO,KAAL,CAAWT,IAAX,CAArB;AACD,KAFD;AAGD,GAJD;;AAMAM,EAAAA,UAAU,CAACI,IAAX,CAAgBH,eAAhB;;AAEA,QAAMI,IAAI,GAAGxB,MAAM,CAACyB,SAAP,CAAiBJ,KAAjB,CAAuBrB,MAAvB,EAA+BmB,UAA/B,CAAb;;AAEA,QAAMO,MAAM,GAAGF,IAAI,IAAI,IAAR,GAAeT,IAAI,CAACO,KAAL,CAAWE,IAAX,EAAiBE,MAAhC,GAAyC,IAAxD;;AAEA,MAAIA,MAAM,IAAIA,MAAM,CAACrB,KAArB,EAA4B;AAC1B,UAAM,IAAIsB,KAAJ,CAAUD,MAAM,CAACrB,KAAP,CAAaE,OAAvB,CAAN;AACD;;AAED,SAAOmB,MAAM,IAAI,IAAV,GAAiBA,MAAM,CAACE,KAAxB,GAAgC,IAAvC;AACD,CAxBD;;AA0BA5B,MAAM,CAAC6B,WAAP,GAAqB,CAACC,OAAD,EAAUZ,QAAV,KAAuB;AAC1C,SAAOlB,MAAM,CAACiB,QAAP,CAAgB,aAAhB,EAA+B,CAAEa,OAAF,CAA/B,EAA4CZ,QAA5C,CAAP;AACD,CAFD;;AAIAlB,MAAM,CAAC+B,cAAP,GAAwB,CAACD,OAAD,EAAUZ,QAAV,KAAuB;AAC7C,QAAMC,UAAU,GAAG,CAAEJ,IAAI,CAACC,SAAL,CAAe,CAAEc,OAAF,CAAf,CAAF,CAAnB;;AAEA,MAAIZ,QAAJ,EAAc;AACZ,UAAME,eAAe,GAAIP,IAAD,IAAU;AAChCb,MAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChBiB,QAAAA,QAAQ,CAACG,KAAT,CAAe,IAAf,EAAqBN,IAAI,CAACO,KAAL,CAAWT,IAAX,CAArB;AACD,OAFD;AAGD,KAJD;;AAMAM,IAAAA,UAAU,CAACI,IAAX,CAAgBH,eAAhB;AACD;;AAED,QAAMM,MAAM,GAAG1B,MAAM,CAACgC,YAAP,CAAoBX,KAApB,CAA0BrB,MAA1B,EAAkCmB,UAAlC,CAAf;;AAEA,MAAIO,MAAM,IAAI,IAAd,EAAoB;AAClB,WAAO,IAAP;AACD;;AAED,QAAM,CAACrB,KAAD,EAAQ4B,QAAR,IAAoBlB,IAAI,CAACO,KAAL,CAAWI,MAAX,CAA1B;;AAEA,MAAI,CAACR,QAAD,IAAab,KAAjB,EAAwB;AACtB,UAAM,IAAIsB,KAAJ,CAAUtB,KAAK,CAACE,OAAhB,CAAN;AACD;;AAED,SAAO0B,QAAP;AACD,CA1BD;;AA4BAjC,MAAM,CAACI,SAAP,GAAoBsB,MAAD,IAAY;AAC7B,SAAOT,QAAQ,CAAC,WAAD,EAAcS,MAAM,IAAI,IAAV,GAAiB,CAAEA,MAAF,CAAjB,GAA8B,IAA5C,CAAf;AACD,CAFD;;AAIA1B,MAAM,CAACkC,UAAP,GAAoB,CAAChB,QAAD,EAAWiB,OAAX,KAAuB;AACzC,SAAOnC,MAAM,CAACiB,QAAP,CAAgB,YAAhB,EAA8B,CAAEkB,OAAF,CAA9B,EAA2CjB,QAA3C,CAAP;AACD,CAFD;;AAIAlB,MAAM,CAACoC,YAAP,GAAuBC,EAAD,IAAQ;AAC5B,SAAOrC,MAAM,CAACiB,QAAP,CAAgB,cAAhB,EAAgC,CAAEoB,EAAF,CAAhC,CAAP;AACD,CAFD;;AAIArC,MAAM,CAACsC,OAAP,GAAiB;AACfC,EAAAA,GAAG,EAAE,CAAC,GAAG1B,IAAJ,KAAa;AAChB,WAAOb,MAAM,CAACiB,QAAP,CAAgB,KAAhB,EAAuB,CAAEJ,IAAF,CAAvB,CAAP;AACD,GAHc;AAIfR,EAAAA,KAAK,EAAE,CAAC,GAAGQ,IAAJ,KAAa;AAClB,WAAOb,MAAM,CAACiB,QAAP,CAAgB,OAAhB,EAAyB,CAAEJ,IAAF,CAAzB,CAAP;AACD;AANc,CAAjB;;AASAb,MAAM,CAACwC,MAAP,GAAiBlC,IAAD,IAAU;AACxBN,EAAAA,MAAM,CAACM,IAAD,CAAN,GAAe,CAAC,GAAGO,IAAJ,KAAa;AAC1B,WAAOb,MAAM,CAACiB,QAAP,CAAgBX,IAAhB,EAAsBO,IAAtB,CAAP;AACD,GAFD;AAGD,CAJD;;AAMAb,MAAM,CAACyC,cAAP,GAAwBzC,MAAM,CAACwC,MAA/B;;AAEAxC,MAAM,CAAC0C,WAAP,GAAsBpC,IAAD,IAAU;AAC7BN,EAAAA,MAAM,CAACM,IAAD,CAAN,GAAe,CAAC,GAAGO,IAAJ,KAAa;AAC1B,UAAMK,QAAQ,GAAGL,IAAI,CAAC8B,GAAL,EAAjB;AAEA,WAAO3C,MAAM,CAACiB,QAAP,CAAgBX,IAAhB,EAAsBO,IAAtB,EAA4BK,QAA5B,CAAP;AACD,GAJD;AAKD,CAND","sourcesContent":["global._try = (func) => {\n  try {\n    func();\n  } catch (ex) {\n    global.setResult({\n      error: {\n        name: ex.name,\n        message: ex.message,\n        stack: ex.stack\n      }\n    });\n  }\n};\n\nglobal._execute = () => {\n  global._try(() => {\n    eval(global._code);\n  });\n};\n\nglobal.debug = (...args) => {\n  global._debug(JSON.stringify(args));\n}\n\nglobal.dispatch = (name, args, callback) => {\n  if (typeof callback !== 'function') {\n    callback = null;\n  }\n\n  const parameters = [ JSON.stringify({ name, args: args || [] }) ];\n\n  const wrappedCallback = (...args) => {\n    global._try(() => {\n      callback.apply(null, JSON.parse(args));\n    });\n  };\n\n  parameters.push(wrappedCallback);\n\n  const json = global._dispatch.apply(global, parameters);\n\n  const result = json != null ? JSON.parse(json).result : null;\n\n  if (result && result.error) {\n    throw new Error(result.error.message);\n  }\n\n  return result != null ? result.value : null;\n}\n\nglobal.httpRequest = (options, callback) => {\n  return global.dispatch('httpRequest', [ options ], callback);\n};\n\nglobal.httpRequestOld = (options, callback) => {\n  const parameters = [ JSON.stringify([ options ]) ];\n\n  if (callback) {\n    const wrappedCallback = (args) => {\n      global._try(() => {\n        callback.apply(null, JSON.parse(args));\n      });\n    };\n\n    parameters.push(wrappedCallback);\n  }\n\n  const result = global._httpRequest.apply(global, parameters);\n\n  if (result == null) {\n    return null;\n  }\n\n  const [error, response] = JSON.parse(result);\n\n  if (!callback && error) {\n    throw new Error(error.message);\n  }\n\n  return response;\n};\n\nglobal.setResult = (result) => {\n  return dispatch('setResult', result != null ? [ result ] : null);\n};\n\nglobal.setTimeout = (callback, timeout) => {\n  return global.dispatch('setTimeout', [ timeout ], callback);\n};\n\nglobal.clearTimeout = (id) => {\n  return global.dispatch('clearTimeout', [ id ]);\n};\n\nglobal.console = {\n  log: (...args) => {\n    return global.dispatch('log', [ args ]);\n  },\n  error: (...args) => {\n    return global.dispatch('error', [ args ]);\n  }\n};\n\nglobal.define = (name) => {\n  global[name] = (...args) => {\n    return global.dispatch(name, args);\n  };\n};\n\nglobal.defineBlocking = global.define;\n\nglobal.defineAsync = (name) => {\n  global[name] = (...args) => {\n    const callback = args.pop();\n\n    return global.dispatch(name, args, callback);\n  };\n};\n"],"file":"runtime.js"}