{"version":3,"sources":["../lib/index.js"],"names":["TimeoutError","Error","isTimeout","Sandbox","execute","code","timeout","callback","executionTimeout","child","join","__dirname","on","message","err","value","clearTimeout","setTimeout","kill","send"],"mappings":";;;;;;AAAA;;AACA;;;;;;AAEA,MAAMA,YAAN,SAA2BC,KAA3B,CAAiC;AAC/B,MAAIC,SAAJ,GAAgB;AACd,WAAO,IAAP;AACD;AAH8B;;AAMlB,MAAMC,OAAN,CAAc;AAC3BC,UAAQC,IAAR,EAAcC,OAAd,EAAuBC,QAAvB,EAAiC;AAC/B,QAAIC,mBAAmB,IAAvB;;AAEA,UAAMC,QAAQ,yBAAK,eAAKC,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAAL,CAAd;;AAEAF,UAAMG,EAAN,CAAS,SAAT,EAAqBC,OAAD,IAAa;AAC/BN,eAASM,QAAQC,GAAjB,EAAsBD,QAAQE,KAA9B;AACD,KAFD;;AAIAN,UAAMG,EAAN,CAAS,OAAT,EAAmBC,OAAD,IAAa;AAC7BG,mBAAaR,gBAAb;AACD,KAFD;;AAIAC,UAAMG,EAAN,CAAS,YAAT,EAAuB,MAAM;AAC3BI,mBAAaR,gBAAb;AACD,KAFD;;AAIAC,UAAMG,EAAN,CAAS,MAAT,EAAkBC,OAAD,IAAa;AAC5BG,mBAAaR,gBAAb;AACD,KAFD;;AAIA,QAAIF,UAAU,CAAd,EAAiB;AACfE,yBAAmBS,WAAW,MAAM;AAClCR,cAAMS,IAAN;AACAX,iBAAS,IAAIP,YAAJ,CAAiB,SAAjB,CAAT;AACD,OAHkB,EAGhBM,OAHgB,CAAnB;AAID;;AAEDG,UAAMU,IAAN,CAAW,EAACd,UAAD,EAAX;AACD;AA9B0B;kBAARF,O","file":"index.js","sourcesContent":["import {fork} from 'child_process';\nimport path from 'path';\n\nclass TimeoutError extends Error {\n  get isTimeout() {\n    return true;\n  }\n}\n\nexport default class Sandbox {\n  execute(code, timeout, callback) {\n    let executionTimeout = null;\n\n    const child = fork(path.join(__dirname, 'worker'));\n\n    child.on('message', (message) => {\n      callback(message.err, message.value);\n    });\n\n    child.on('error', (message) => {\n      clearTimeout(executionTimeout);\n    });\n\n    child.on('disconnect', () => {\n      clearTimeout(executionTimeout);\n    });\n\n    child.on('exit', (message) => {\n      clearTimeout(executionTimeout);\n    });\n\n    if (timeout > 0) {\n      executionTimeout = setTimeout(() => {\n        child.kill();\n        callback(new TimeoutError('timeout'));\n      }, timeout);\n    }\n\n    child.send({code});\n  }\n}\n"]}