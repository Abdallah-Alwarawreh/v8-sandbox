{"version":3,"sources":["../lib/runtime.js"],"names":["global","_try","func","ex","setResult","error","name","message","stack","_execute","eval","_code","_callbackID","_callbacks","_callback","JSON","parse","callback","id","apply","args","dispatchSync","parameters","stringify","result","_dispatchSync","_debug","value","Error","dispatchAsync","async","wrappedCallback","push","_dispatchAsync","httpRequest","options","_httpRequest","response","setTimeout","timeout","handler","_setTimeout","clearTimeout","_clearTimeout","console","log","_log","_error","define","defineBlocking","defineAsync","pop"],"mappings":"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","sourcesContent":["global._try = (func) => {\n  try {\n    func();\n  } catch (ex) {\n    global.setResult({\n      error: {\n        name: ex.name,\n        message: ex.message,\n        stack: ex.stack\n      }\n    });\n  }\n};\n\nglobal._execute = () => {\n  global._try(() => {\n    eval(global._code);\n  });\n};\n\nglobal._callbackID = 0;\n\nglobal._callbacks = {};\n\nglobal._callback = (message) => {\n  message = JSON.parse(message);\n\n  const callback = global._callbacks[message.id];\n  \n  if (callback) {\n    delete global._callbacks[message.id];\n\n    callback.apply(null, message.args);\n  }\n}\n\nglobal.dispatchSync = (name, args) => {\n  const id = global._callbackID++;\n\n  const parameters = [ id, JSON.stringify({ id, name, args: args || [] }) ];\n\n  const result = global._dispatchSync.apply(global, parameters);\n\n  _debug(\"REZZZZZ\");\n  _debug(JSON.stringify(result));\n\n  if (result == null) {\n    return null;\n  }\n\n  const {error, value} = JSON.parse(result).result;\n\n  if (error) {\n    throw new Error(error.message);\n  }\n\n  global._debug(\"Hello3\");\n\n  return value;\n}\n\nglobal.dispatchAsync = (name, args, callback) => {\n  if (typeof callback !== 'function') {\n    callback = () => {};\n  }\n\n  const id = global._callbackID++;\n\n  const parameters = [ id, JSON.stringify({ id, name, async: true, args: args || [] }) ];\n\n  const wrappedCallback = (...args) => {\n    global._try(() => {\n      callback.apply(null, JSON.parse(args));\n    });\n  };\n\n  parameters.push(wrappedCallback);\n\n  _debug(\"yoyoyoyoyoyoyoy\");\n  _debug(typeof(global._dispatchAsync))\n\n  _debug(JSON.stringify(parameters));\n\n  const result = global._dispatchAsync.apply(global, parameters);\n\n  _debug(\"afterit\")\n\n  return result != null ? JSON.parse(result) : null;\n}\n\nglobal.httpRequest = (options, callback) => {\n  const parameters = [ JSON.stringify([ options ]) ];\n\n  if (callback) {\n    const wrappedCallback = (args) => {\n      global._try(() => {\n        callback.apply(null, JSON.parse(args));\n      });\n    };\n\n    parameters.push(wrappedCallback);\n  }\n\n  const result = global._httpRequest.apply(global, parameters);\n\n  if (result == null) {\n    return null;\n  }\n\n  const [error, response] = JSON.parse(result);\n\n  if (!callback && error) {\n    throw new Error(error.message);\n  }\n\n  return response;\n};\n\nglobal.setResult = (result) => {\n  return dispatchSync('setResult', result != null ?  [ result ] : null);\n  // return global._setResult(result != null ? JSON.stringify(result) : null);\n};\n\nglobal.setTimeout = (callback, timeout) => {\n  const handler = () => {\n    global._try(callback);\n  };\n\n  return global._setTimeout(handler, timeout);\n};\n\nglobal.clearTimeout = (id) => {\n  return global._clearTimeout(id);\n};\n\nglobal.console = {\n  log: (...args) => {\n    global._log(JSON.stringify(args));\n  },\n  error: (...args) => {\n    global._error(JSON.stringify(args));\n  }\n};\n\nglobal.define = (name) => {\n  global[name] = (...args) => {\n    return global.dispatchSync(name, args);\n  };\n};\n\nglobal.defineBlocking = global.define;\n\nglobal.defineAsync = (name) => {\n  global[name] = (...args) => {\n    const callback = args.pop();\n\n    return global.dispatchAsync(name, args, callback);\n  };\n};\n"],"file":"runtime.js"}