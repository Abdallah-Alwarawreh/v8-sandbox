{"version":3,"sources":["../lib/runtime.js"],"names":["global","_try","func","ex","setResult","error","test","name","message","stack","_execute","eval","_code","_callbackID","dispatchSync","args","id","parameters","JSON","stringify","result","_dispatchSync","apply","value","parse","Error","debug","_debug","dispatchAsync","callback","async","wrappedCallback","push","json","_dispatchAsync","httpRequest","options","httpRequestOld","_httpRequest","response","setTimeout","timeout","clearTimeout","console","log","_log","_error","define","defineBlocking","defineAsync","pop"],"mappings":"AAAAA,MAAM,CAACC,IAAP,GAAeC,IAAD,IAAU;AACtB,MAAI;AACFA,IAAAA,IAAI;AACL,GAFD,CAEE,OAAOC,EAAP,EAAW;AACXH,IAAAA,MAAM,CAACI,SAAP,CAAiB;AACfC,MAAAA,KAAK,EAAE;AACLC,QAAAA,IAAI,EAAE,CADD;AAELC,QAAAA,IAAI,EAAEJ,EAAE,CAACI,IAFJ;AAGLC,QAAAA,OAAO,EAAEL,EAAE,CAACK,OAHP;AAILC,QAAAA,KAAK,EAAEN,EAAE,CAACM;AAJL;AADQ,KAAjB;AAQD;AACF,CAbD;;AAeAT,MAAM,CAACU,QAAP,GAAkB,MAAM;AACtBV,EAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChBU,IAAAA,IAAI,CAACX,MAAM,CAACY,KAAR,CAAJ;AACD,GAFD;AAGD,CAJD;;AAMAZ,MAAM,CAACa,WAAP,GAAqB,CAArB;;AAEAb,MAAM,CAACc,YAAP,GAAsB,CAACP,IAAD,EAAOQ,IAAP,KAAgB;AACpC,QAAMC,EAAE,GAAGhB,MAAM,CAACa,WAAP,EAAX;AAEA,QAAMI,UAAU,GAAG,CAAED,EAAF,EAAME,IAAI,CAACC,SAAL,CAAe;AAAEH,IAAAA,EAAF;AAAMT,IAAAA,IAAN;AAAYQ,IAAAA,IAAI,EAAEA,IAAI,IAAI;AAA1B,GAAf,CAAN,CAAnB;;AAEA,QAAMK,MAAM,GAAGpB,MAAM,CAACqB,aAAP,CAAqBC,KAArB,CAA2BtB,MAA3B,EAAmCiB,UAAnC,CAAf;;AAEA,MAAIG,MAAM,IAAI,IAAd,EAAoB;AAClB,WAAO,IAAP;AACD;;AAED,QAAM;AAACf,IAAAA,KAAD;AAAQkB,IAAAA;AAAR,MAAiBL,IAAI,CAACM,KAAL,CAAWJ,MAAX,EAAmBA,MAA1C;;AAEA,MAAIf,KAAJ,EAAW;AACT,UAAM,IAAIoB,KAAJ,CAAUpB,KAAK,CAACG,OAAhB,CAAN;AACD;;AAED,SAAOe,KAAP;AACD,CAlBD;;AAoBAvB,MAAM,CAAC0B,KAAP,GAAe,CAAC,GAAGX,IAAJ,KAAa;AAC1Bf,EAAAA,MAAM,CAAC2B,MAAP,CAAcT,IAAI,CAACC,SAAL,CAAeJ,IAAf,CAAd;AACD,CAFD;;AAIAf,MAAM,CAAC4B,aAAP,GAAuB,CAACrB,IAAD,EAAOQ,IAAP,EAAac,QAAb,KAA0B;AAC/C,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClCA,IAAAA,QAAQ,GAAG,MAAM,CAAE,CAAnB;AACD;;AAED,QAAMb,EAAE,GAAGhB,MAAM,CAACa,WAAP,EAAX;AAEA,QAAMI,UAAU,GAAG,CAAED,EAAF,EAAME,IAAI,CAACC,SAAL,CAAe;AAAEH,IAAAA,EAAF;AAAMT,IAAAA,IAAN;AAAYuB,IAAAA,KAAK,EAAE,IAAnB;AAAyBf,IAAAA,IAAI,EAAEA,IAAI,IAAI;AAAvC,GAAf,CAAN,CAAnB;;AAEA,QAAMgB,eAAe,GAAG,CAAC,GAAGhB,IAAJ,KAAa;AACnCf,IAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChB4B,MAAAA,QAAQ,CAACP,KAAT,CAAe,IAAf,EAAqBJ,IAAI,CAACM,KAAL,CAAWT,IAAX,CAArB;AACD,KAFD;AAGD,GAJD;;AAMAE,EAAAA,UAAU,CAACe,IAAX,CAAgBD,eAAhB;;AAEA,QAAME,IAAI,GAAGjC,MAAM,CAACkC,cAAP,CAAsBZ,KAAtB,CAA4BtB,MAA5B,EAAoCiB,UAApC,CAAb;;AAEA,QAAMG,MAAM,GAAGa,IAAI,IAAI,IAAR,GAAef,IAAI,CAACM,KAAL,CAAWS,IAAX,EAAiBb,MAAhC,GAAyC,IAAxD;;AAEA,MAAIA,MAAM,IAAIA,MAAM,CAACf,KAArB,EAA4B;AAC1B,UAAM,IAAIoB,KAAJ,CAAUL,MAAM,CAACf,KAAP,CAAaG,OAAvB,CAAN;AACD;;AAED,SAAOY,MAAM,IAAI,IAAV,GAAiBA,MAAM,CAACG,KAAxB,GAAgC,IAAvC;AACD,CA1BD;;AA4BAvB,MAAM,CAACmC,WAAP,GAAqB,CAACC,OAAD,EAAUP,QAAV,KAAuB;AAC1C,SAAO7B,MAAM,CAAC4B,aAAP,CAAqB,aAArB,EAAoC,CAAEQ,OAAF,CAApC,EAAiDP,QAAjD,CAAP;AACD,CAFD;;AAIA7B,MAAM,CAACqC,cAAP,GAAwB,CAACD,OAAD,EAAUP,QAAV,KAAuB;AAC7C,QAAMZ,UAAU,GAAG,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEiB,OAAF,CAAf,CAAF,CAAnB;;AAEA,MAAIP,QAAJ,EAAc;AACZ,UAAME,eAAe,GAAIhB,IAAD,IAAU;AAChCf,MAAAA,MAAM,CAACC,IAAP,CAAY,MAAM;AAChB4B,QAAAA,QAAQ,CAACP,KAAT,CAAe,IAAf,EAAqBJ,IAAI,CAACM,KAAL,CAAWT,IAAX,CAArB;AACD,OAFD;AAGD,KAJD;;AAMAE,IAAAA,UAAU,CAACe,IAAX,CAAgBD,eAAhB;AACD;;AAED,QAAMX,MAAM,GAAGpB,MAAM,CAACsC,YAAP,CAAoBhB,KAApB,CAA0BtB,MAA1B,EAAkCiB,UAAlC,CAAf;;AAEA,MAAIG,MAAM,IAAI,IAAd,EAAoB;AAClB,WAAO,IAAP;AACD;;AAED,QAAM,CAACf,KAAD,EAAQkC,QAAR,IAAoBrB,IAAI,CAACM,KAAL,CAAWJ,MAAX,CAA1B;;AAEA,MAAI,CAACS,QAAD,IAAaxB,KAAjB,EAAwB;AACtB,UAAM,IAAIoB,KAAJ,CAAUpB,KAAK,CAACG,OAAhB,CAAN;AACD;;AAED,SAAO+B,QAAP;AACD,CA1BD;;AA4BAvC,MAAM,CAACI,SAAP,GAAoBgB,MAAD,IAAY;AAC7B,SAAON,YAAY,CAAC,WAAD,EAAcM,MAAM,IAAI,IAAV,GAAkB,CAAEA,MAAF,CAAlB,GAA+B,IAA7C,CAAnB,CAD6B,CAE7B;AACD,CAHD;;AAKApB,MAAM,CAACwC,UAAP,GAAoB,CAACX,QAAD,EAAWY,OAAX,KAAuB;AACzC,SAAOzC,MAAM,CAAC4B,aAAP,CAAqB,YAArB,EAAmC,CAAEa,OAAF,CAAnC,EAAgDZ,QAAhD,CAAP;AACD,CAFD;;AAIA7B,MAAM,CAAC0C,YAAP,GAAuB1B,EAAD,IAAQ;AAC5B,SAAOhB,MAAM,CAAC4B,aAAP,CAAqB,cAArB,EAAqC,CAAEZ,EAAF,CAArC,CAAP;AACD,CAFD;;AAIAhB,MAAM,CAAC2C,OAAP,GAAiB;AACfC,EAAAA,GAAG,EAAE,CAAC,GAAG7B,IAAJ,KAAa;AAChBf,IAAAA,MAAM,CAAC6C,IAAP,CAAY3B,IAAI,CAACC,SAAL,CAAeJ,IAAf,CAAZ;AACD,GAHc;AAIfV,EAAAA,KAAK,EAAE,CAAC,GAAGU,IAAJ,KAAa;AAClBf,IAAAA,MAAM,CAAC8C,MAAP,CAAc5B,IAAI,CAACC,SAAL,CAAeJ,IAAf,CAAd;AACD;AANc,CAAjB;;AASAf,MAAM,CAAC+C,MAAP,GAAiBxC,IAAD,IAAU;AACxBP,EAAAA,MAAM,CAACO,IAAD,CAAN,GAAe,CAAC,GAAGQ,IAAJ,KAAa;AAC1B,WAAOf,MAAM,CAACc,YAAP,CAAoBP,IAApB,EAA0BQ,IAA1B,CAAP;AACD,GAFD;AAGD,CAJD;;AAMAf,MAAM,CAACgD,cAAP,GAAwBhD,MAAM,CAAC+C,MAA/B;;AAEA/C,MAAM,CAACiD,WAAP,GAAsB1C,IAAD,IAAU;AAC7BP,EAAAA,MAAM,CAACO,IAAD,CAAN,GAAe,CAAC,GAAGQ,IAAJ,KAAa;AAC1B,UAAMc,QAAQ,GAAGd,IAAI,CAACmC,GAAL,EAAjB;AAEA,WAAOlD,MAAM,CAAC4B,aAAP,CAAqBrB,IAArB,EAA2BQ,IAA3B,EAAiCc,QAAjC,CAAP;AACD,GAJD;AAKD,CAND","sourcesContent":["global._try = (func) => {\n  try {\n    func();\n  } catch (ex) {\n    global.setResult({\n      error: {\n        test: 1,\n        name: ex.name,\n        message: ex.message,\n        stack: ex.stack\n      }\n    });\n  }\n};\n\nglobal._execute = () => {\n  global._try(() => {\n    eval(global._code);\n  });\n};\n\nglobal._callbackID = 0;\n\nglobal.dispatchSync = (name, args) => {\n  const id = global._callbackID++;\n\n  const parameters = [ id, JSON.stringify({ id, name, args: args || [] }) ];\n\n  const result = global._dispatchSync.apply(global, parameters);\n\n  if (result == null) {\n    return null;\n  }\n\n  const {error, value} = JSON.parse(result).result;\n\n  if (error) {\n    throw new Error(error.message);\n  }\n\n  return value;\n}\n\nglobal.debug = (...args) => {\n  global._debug(JSON.stringify(args));\n}\n\nglobal.dispatchAsync = (name, args, callback) => {\n  if (typeof callback !== 'function') {\n    callback = () => {};\n  }\n\n  const id = global._callbackID++;\n\n  const parameters = [ id, JSON.stringify({ id, name, async: true, args: args || [] }) ];\n\n  const wrappedCallback = (...args) => {\n    global._try(() => {\n      callback.apply(null, JSON.parse(args));\n    });\n  };\n\n  parameters.push(wrappedCallback);\n\n  const json = global._dispatchAsync.apply(global, parameters);\n\n  const result = json != null ? JSON.parse(json).result : null;\n\n  if (result && result.error) {\n    throw new Error(result.error.message);\n  }\n\n  return result != null ? result.value : null;\n}\n\nglobal.httpRequest = (options, callback) => {\n  return global.dispatchAsync('httpRequest', [ options ], callback);\n};\n\nglobal.httpRequestOld = (options, callback) => {\n  const parameters = [ JSON.stringify([ options ]) ];\n\n  if (callback) {\n    const wrappedCallback = (args) => {\n      global._try(() => {\n        callback.apply(null, JSON.parse(args));\n      });\n    };\n\n    parameters.push(wrappedCallback);\n  }\n\n  const result = global._httpRequest.apply(global, parameters);\n\n  if (result == null) {\n    return null;\n  }\n\n  const [error, response] = JSON.parse(result);\n\n  if (!callback && error) {\n    throw new Error(error.message);\n  }\n\n  return response;\n};\n\nglobal.setResult = (result) => {\n  return dispatchSync('setResult', result != null ?  [ result ] : null);\n  // return global._setResult(result != null ? JSON.stringify(result) : null);\n};\n\nglobal.setTimeout = (callback, timeout) => {\n  return global.dispatchAsync('setTimeout', [ timeout ], callback);\n};\n\nglobal.clearTimeout = (id) => {\n  return global.dispatchAsync('clearTimeout', [ id ]);\n};\n\nglobal.console = {\n  log: (...args) => {\n    global._log(JSON.stringify(args));\n  },\n  error: (...args) => {\n    global._error(JSON.stringify(args));\n  }\n};\n\nglobal.define = (name) => {\n  global[name] = (...args) => {\n    return global.dispatchSync(name, args);\n  };\n};\n\nglobal.defineBlocking = global.define;\n\nglobal.defineAsync = (name) => {\n  global[name] = (...args) => {\n    const callback = args.pop();\n\n    return global.dispatchAsync(name, args, callback);\n  };\n};\n"],"file":"runtime.js"}